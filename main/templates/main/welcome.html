<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’ç©ºã‚»ãƒ¬ã‚¯ãƒˆï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root {
            /* Material Design 3 Color System - Light Mode */
            --md-primary: #6750a4;
            --md-on-primary: #ffffff;
            --md-primary-container: #eaddff;
            --md-on-primary-container: #21005d;
            
            --md-secondary: #625b71;
            --md-on-secondary: #ffffff;
            --md-secondary-container: #e8def8;
            --md-on-secondary-container: #1d192b;
            
            --md-surface: #fffbfe;
            --md-on-surface: #1c1b1f;
            --md-surface-variant: #f4eff4;
            --md-on-surface-variant: #49454f;
            
            --md-outline: #79747e;
            --md-outline-variant: #cab6cf;
            
            --md-error: #ba1a1a;
            --md-on-error: #ffffff;
            
            /* Elevation */
            --md-elevation-1: 0px 1px 3px rgba(0, 0, 0, 0.12), 0px 1px 2px rgba(0, 0, 0, 0.24);
            --md-elevation-2: 0px 3px 6px rgba(0, 0, 0, 0.16), 0px 3px 6px rgba(0, 0, 0, 0.23);
            --md-elevation-3: 0px 6px 12px rgba(0, 0, 0, 0.15), 0px 4px 6px rgba(0, 0, 0, 0.10);
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --md-primary: #d0bcff;
            --md-on-primary: #381e72;
            --md-primary-container: #4f378b;
            --md-on-primary-container: #eaddff;
            
            --md-secondary: #ccc2dc;
            --md-on-secondary: #332d41;
            --md-secondary-container: #4a4458;
            --md-on-secondary-container: #e8def8;
            
            --md-surface: #141218;
            --md-on-surface: #e6e0e9;
            --md-surface-variant: #49454f;
            --md-on-surface-variant: #cab6cf;
            
            --md-outline: #938f99;
            --md-outline-variant: #49454f;
            
            --md-error: #ffb4ab;
            --md-on-error: #690005;
            
            /* Dark Mode Elevation */
            --md-elevation-1: 0px 1px 3px rgba(0, 0, 0, 0.30), 0px 1px 2px rgba(0, 0, 0, 0.50);
            --md-elevation-2: 0px 3px 6px rgba(0, 0, 0, 0.40), 0px 3px 6px rgba(0, 0, 0, 0.60);
            --md-elevation-3: 0px 6px 12px rgba(0, 0, 0, 0.50), 0px 4px 6px rgba(0, 0, 0, 0.30);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            line-height: 1.6;
            color: var(--md-on-surface);
            background: var(--md-surface);
            font-weight: 400;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }
        
        /* Header */
        header {
            background: var(--md-surface);
            border-bottom: 1px solid var(--md-outline-variant);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(8px);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            min-height: 64px;
        }
        
        .logo {
            font-size: 22px;
            font-weight: 600;
            color: var(--md-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-links {
            display: flex;
            gap: 8px;
            list-style: none;
            align-items: center;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--md-on-surface-variant);
            font-weight: 500;
            padding: 10px 16px;
            border-radius: 20px;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .nav-links a:hover {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            border: 1px solid var(--md-outline-variant);
            border-radius: 20px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .theme-toggle:hover {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }
        
        /* Hero Section */
        .hero {
            padding: 120px 0 64px;
            text-align: center;
            background: var(--md-surface);
        }
        
        .hero h1 {
            font-size: 3.5rem;
            font-weight: 300;
            color: var(--md-on-surface);
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }
        
        .hero .subtitle {
            font-size: 1.25rem;
            color: var(--md-on-surface-variant);
            margin-bottom: 8px;
            font-weight: 400;
        }
        
        .hero .description {
            font-size: 1rem;
            color: var(--md-on-surface-variant);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.7;
        }
        
        .beta-badge {
            display: inline-block;
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 24px;
            letter-spacing: 0.5px;
        }
        
        /* Weather & Recommendation Section */
        .weather-recommendation-section {
            padding: 64px 0;
            background: var(--md-primary-container);
        }
        
        .weather-recommendation-card {
            background: var(--md-surface);
            border-radius: 24px;
            box-shadow: var(--md-elevation-2);
            padding: 32px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .section-header h2 {
            font-size: 1.75rem;
            font-weight: 500;
            color: var(--md-on-surface);
            margin-bottom: 8px;
        }
        
        /* Weather Compact Display */
        .weather-compact {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 24px;
            align-items: center;
            background: var(--md-surface-variant);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 32px;
        }
        
        .weather-icon {
            font-size: 2.5rem;
        }
        
        .weather-main-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .weather-location {
            font-size: 18px;
            font-weight: 600;
            color: var(--md-on-surface);
        }
        
        .weather-temp {
            font-size: 24px;
            font-weight: 700;
            color: var(--md-primary);
        }
        
        .weather-desc {
            font-size: 14px;
            color: var(--md-on-surface-variant);
        }
        
        .weather-details-mini {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            text-align: right;
            font-size: 12px;
        }
        
        .weather-detail-mini {
            color: var(--md-on-surface-variant);
        }
        
        .weather-detail-mini .value {
            font-weight: 600;
            color: var(--md-on-surface);
        }
        
        /* Recommendation within weather section */
        .recommendation-embedded {
            border-top: 1px solid var(--md-outline-variant);
            padding-top: 24px;
        }
        
        .recommendation-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .recommendation-header h3 {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--md-on-surface);
            margin-bottom: 8px;
        }
        
        .recommendation-header p {
            color: var(--md-on-surface-variant);
            font-size: 14px;
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* Buttons */
        .btn-primary {
            background: var(--md-primary);
            color: var(--md-on-primary);
            border: none;
            padding: 14px 32px;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--md-elevation-1);
        }
        
        .btn-primary:hover {
            box-shadow: var(--md-elevation-2);
            transform: translateY(-1px);
        }
        
        .btn-primary:disabled {
            background: var(--md-outline-variant);
            color: var(--md-on-surface-variant);
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover {
            background: var(--md-on-secondary-container);
            color: var(--md-secondary-container);
        }
        
        /* Radio buttons styled as Material chips */
        .chip-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .chip {
            position: relative;
        }
        
        .chip input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        .chip label {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--md-surface-variant);
            color: var(--md-on-surface-variant);
            padding: 12px 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--md-outline-variant);
            font-size: 14px;
            font-weight: 500;
        }
        
        .chip input[type="radio"]:checked + label {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
            border-color: var(--md-secondary);
        }
        
        /* Footer */
        .footer {
            background: var(--md-surface-variant);
            padding: 32px 0;
            text-align: center;
            border-top: 1px solid var(--md-outline-variant);
        }
        
        .footer p {
            color: var(--md-on-surface-variant);
            font-size: 14px;
        }
        
        /* Status indicator */
        .status-indicator {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--md-primary);
            color: var(--md-on-primary);
            padding: 8px 16px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            box-shadow: var(--md-elevation-2);
            z-index: 1000;
        }
        
        /* Loading and result styles */
        .result-card {
            background: var(--md-primary-container);
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--md-outline-variant);
            border-radius: 50%;
            border-top-color: var(--md-primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .weather-compact {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 16px;
            }
            
            .weather-details-mini {
                grid-template-columns: repeat(4, 1fr);
                text-align: center;
            }
            
            .nav-links a:not(.theme-toggle) {
                display: none;
            }
            
            .chip-group {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <a href="/" class="logo">ğŸ“š é’ç©ºã‚»ãƒ¬ã‚¯ãƒˆ</a>
            <ul class="nav-links">
                <li><a href="/test/">é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«</a></li>
                <li><a href="/accounts/register-page/" id="loginLink">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
                <li><a href="/admin/">ç®¡ç†</a></li>
                <li><button class="theme-toggle" id="themeToggle">
                    <span id="themeIcon">ğŸŒ™</span>
                    <span>ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</span>
                </button></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <div class="beta-badge">ğŸš€ BETA VERSION</div>
                <h1>é’ç©ºã‚»ãƒ¬ã‚¯ãƒˆ</h1>
                <p class="subtitle">ã‚ãªãŸã®ä»Šã«å¯„ã‚Šæ·»ã†çŸ­ç·¨ã‚’ã€é’ç©ºæ–‡åº«ã‹ã‚‰</p>
                <p class="description">ä½ç½®æƒ…å ±ã¨å¤©æ°—ã‹ã‚‰ã€ãã®ç¬é–“ã«ã´ã£ãŸã‚Šã®çŸ­ç·¨å°èª¬ã‚’ãŠå±Šã‘ã—ã¾ã™</p>
            </div>
        </section>

        <!-- å¤©æ°—æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="weather-recommendation-section">
            <div class="container">
                <div id="weatherContainer" class="weather-recommendation-card">
                    <div id="weatherLoading" style="display: none;">
                        <h3>ğŸ“ ç¾åœ¨åœ°ã®å¤©æ°—ã‚’å–å¾—ä¸­...</h3>
                        <p>ä½ç½®æƒ…å ±ã‚’è¨±å¯ã™ã‚‹ã¨ã€ã‚ãªãŸã®ç’°å¢ƒã«åˆã£ãŸä½œå“ã‚’ãŠã™ã™ã‚ã§ãã¾ã™</p>
                    </div>
                    
                    <div id="weatherContent" style="display: none;">
                        <div class="section-header">
                            <h2>ğŸŒ¤ï¸ ä»Šæ—¥ã®å¤©æ°—</h2>
                        </div>
                        <div class="weather-compact">
                            <div class="weather-icon" id="weatherEmoji">ğŸŒ¤ï¸</div>
                            <div class="weather-main-info">
                                <div class="weather-location" id="weatherLocation">ç¾åœ¨åœ°</div>
                                <div class="weather-temp" id="weatherTemp">--Â°C</div>
                                <div class="weather-desc" id="weatherDesc">--</div>
                            </div>
                            <div class="weather-details-mini">
                                <div class="weather-detail-mini">
                                    <div class="label">ä½“æ„Ÿæ¸©åº¦</div>
                                    <div class="value" id="weatherFeelsLike">--Â°C</div>
                                </div>
                                <div class="weather-detail-mini">
                                    <div class="label">æ¹¿åº¦</div>
                                    <div class="value" id="weatherHumidity">--%</div>
                                </div>
                                <div class="weather-detail-mini">
                                    <div class="label">é¢¨é€Ÿ</div>
                                    <div class="value" id="weatherWind">-- m/s</div>
                                </div>
                                <div class="weather-detail-mini">
                                    <div class="label">é›²é‡</div>
                                    <div class="value" id="weatherClouds">--%</div>
                                </div>
                            </div>
                        </div>

                        <div class="recommendation-embedded">
                            <div class="recommendation-header">
                                <h3>ğŸ¯ ä»Šæ—¥ã®ãŠã™ã™ã‚</h3>
                                <p>å¤©æ°—ã¨æ™‚é–“ã‚’è€ƒæ…®ã—ã¦ã€ä»Šã“ã®ç¬é–“ã«èª­ã¿ãŸããªã‚‹é’ç©ºæ–‡åº«ã®çŸ­ç·¨ã‚’AIãŒã‚»ãƒ¬ã‚¯ãƒˆã—ã¾ã™</p>
                            </div>
                            
                            <!-- æ¨è–¦è¨­å®š -->
                            <div id="recommendationSettings">
                                <div class="chip-group">
                                    <div class="chip">
                                        <input type="radio" name="recommendType" value="simple" checked id="simpleRadio">
                                        <label for="simpleRadio">âš¡ ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ</label>
                                    </div>
                                    <div class="chip">
                                        <input type="radio" name="recommendType" value="ai-flash" id="aiFlashRadio">
                                        <label for="aiFlashRadio">ğŸš€ AIç‰ˆï¼ˆè»½é‡ï¼‰</label>
                                    </div>
                                    <div class="chip">
                                        <input type="radio" name="recommendType" value="ai-pro" id="aiProRadio">
                                        <label for="aiProRadio">ğŸ§  AIç‰ˆï¼ˆé«˜æ€§èƒ½ï¼‰</label>
                                    </div>
                                </div>
                                
                                <!-- ãƒ¢ãƒ‡ãƒ«èª¬æ˜ -->
                                <div id="modelDescription" style="margin-top: 16px; padding: 12px; background: rgba(var(--md-primary-rgb), 0.08); border-radius: 8px; font-size: 14px; text-align: center; color: var(--md-on-surface-variant); display: none;">
                                    <div id="flashDescription" style="display: none;">
                                        <strong>Gemini 2.5 Flash:</strong> é«˜é€Ÿã§åŠ¹ç‡çš„ãªè»½é‡ãƒ¢ãƒ‡ãƒ«ã€‚è¿…é€Ÿãªæ¨è–¦ã‚’ãŠæ±‚ã‚ã®æ–¹ã«æœ€é©ã§ã™ã€‚
                                    </div>
                                    <div id="proDescription" style="display: none;">
                                        <strong>Gemini 2.5 Pro:</strong> ã‚ˆã‚Šæ·±ã„åˆ†æã¨æ´—ç·´ã•ã‚ŒãŸæ¨è–¦ã‚’æä¾›ã™ã‚‹é«˜æ€§èƒ½ãƒ¢ãƒ‡ãƒ«ã€‚ã‚ã‚“ã¾ã‚Šä½¿ã†ã¨ãŠé‡‘ãŒã‹ã‹ã‚‹ã‹ã‚‰ã€ãã‚“ãªã«ä½¿ã‚ãªã„ã§ã­ã€‚
                                    </div>
                                </div>

                                <div style="text-align: center; margin-top: 24px;">
                                    <button class="btn-primary" id="getRecommendationBtn" onclick="getBookRecommendation()">
                                        ğŸ¯ ä»Šã™ãä½œå“ã‚’æ¨è–¦ã—ã¦ã‚‚ã‚‰ã†
                                    </button>
                                    <div style="margin-top: 16px; font-size: 14px; color: var(--md-on-surface-variant);">
                                        <span id="locationStatus">ğŸ“ ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã¦ã€ã‚ãªãŸã®ç’°å¢ƒã«æœ€é©ãªä½œå“ã‚’ãŠé¸ã³ã—ã¾ã™</span>
                                    </div>
                                </div>
                            </div>

                            <!-- æ¨è–¦çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                            <div id="recommendationResults" style="display: none;">
                                <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
                                <div id="recommendationLoading" class="result-card" style="
                                    text-align: center; 
                                    padding: 40px; 
                                    display: none;
                                ">
                                    <div class="loading-spinner" style="margin-bottom: 16px;"></div>
                                    <h3 style="margin-bottom: 10px; color: var(--md-on-surface);">ä½œå“ã‚’é¸æ›¸ä¸­...</h3>
                                    <p style="color: var(--md-on-surface-variant);">å¤©æ°—ã¨æ™‚é–“ã‚’è€ƒæ…®ã—ã¦æœ€é©ãªä½œå“ã‚’æ¢ã—ã¦ã„ã¾ã™</p>
                                </div>

                                <!-- æ¨è–¦çµæœ -->
                                <div id="recommendationContent" style="display: none;">
                                    <!-- ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆçµæœ -->
                                    <div id="simpleRecommendationResult" style="display: none;">
                                        <div class="result-card">
                                            <div style="text-align: center; margin-bottom: 25px;">
                                                <h3 style="font-size: 1.5rem; margin-bottom: 10px;">ğŸ“š ãŠã™ã™ã‚ã‚¸ãƒ£ãƒ³ãƒ«</h3>
                                                <p id="recommendedMood" style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 15px;"></p>
                                                <p id="weatherMessage" style="opacity: 0.8; font-style: italic;"></p>
                                            </div>
                                            
                                            <div style="text-align: center;">
                                                <h4 style="margin-bottom: 15px;">âœ¨ ãŠã™ã™ã‚ä½œå®¶</h4>
                                                <div id="suggestedAuthors" style="
                                                    display: flex; 
                                                    gap: 15px; 
                                                    justify-content: center; 
                                                    flex-wrap: wrap;
                                                "></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- AIç‰ˆçµæœ -->
                                    <div id="aiRecommendationResult" style="display: none;">
                                        <div class="result-card">
                                            <div style="text-align: center; margin-bottom: 20px;">
                                                <h3 style="font-size: 1.5rem; margin-bottom: 10px;">ğŸ¤– AIæ¨è–¦ä½œå“</h3>
                                                <div id="aiModelInfo" style="
                                                    font-size: 0.9rem; 
                                                    opacity: 0.8; 
                                                    margin-bottom: 10px;
                                                    color: var(--md-primary);
                                                "></div>
                                            </div>
                                            <div id="aiRecommendationText" style="
                                                font-size: 1.05rem; 
                                                line-height: 1.8; 
                                                white-space: pre-line;
                                                background: rgba(255,255,255,0.05);
                                                padding: 25px;
                                                border-radius: 15px;
                                                border-left: 4px solid rgba(255,255,255,0.3);
                                            "></div>
                                        </div>
                                    </div>

                                    <!-- å†æ¨è–¦ãƒœã‚¿ãƒ³ -->
                                    <div style="text-align: center; margin-top: 25px;">
                                        <button class="btn-secondary" onclick="getBookRecommendation()">
                                            ğŸ”„ åˆ¥ã®ä½œå“ã‚’æ¨è–¦ã—ã¦ã‚‚ã‚‰ã†
                                        </button>
                                    </div>
                                </div>

                                <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                                <div id="recommendationError" style="display: none;">
                                    <div class="result-card">
                                        <div style="
                                            background: rgba(255,107,107,0.2); 
                                            border: 2px solid rgba(255,107,107,0.4);
                                            border-radius: 15px; 
                                            padding: 25px; 
                                            text-align: center;
                                        ">
                                            <div style="font-size: 2rem; margin-bottom: 15px;">ğŸ˜”</div>
                                            <h3 style="margin-bottom: 10px;">æ¨è–¦å–å¾—ã‚¨ãƒ©ãƒ¼</h3>
                                            <p id="recommendationErrorMessage" style="opacity: 0.9; margin-bottom: 15px;"></p>
                                            <button class="btn-secondary" onclick="getBookRecommendation()">
                                                ğŸ”„ å†è©¦è¡Œ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="weatherError" style="display: none;">
                        <div class="result-card">
                            <h3>ğŸŒ¤ï¸ å¤©æ°—æƒ…å ±</h3>
                            <p>ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ãŒã€ç´ æ•µãªèª­æ›¸æ™‚é–“ã‚’ãŠéã”ã—ãã ã•ã„</p>
                            {% if weather_data %}
                            <div style="margin-top: 20px;">
                                <div style="font-size: 2rem;">{{ weather_emoji }}</div>
                                <div style="font-size: 1.5rem; margin: 10px 0;">{{ weather_data.city_name }} {{ weather_data.temperature }}Â°C</div>
                                <div>{{ weather_data.weather_description }}</div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 é’ç©ºã‚»ãƒ¬ã‚¯ãƒˆ - Powered by Django & é’ç©ºæ–‡åº«</p>
        </div>
    </footer>

    <div class="status-indicator" id="apiStatus">
        ğŸ”Œ APIæ¥ç¶šç¢ºèªä¸­...
    </div>

    <script>
        // API ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
        async function checkAPIStatus() {
            try {
                const response = await fetch('/api/health/');
                const data = await response.json();
                
                const statusEl = document.getElementById('apiStatus');
                if (data.status === 'ok') {
                    statusEl.innerHTML = 'âœ… API æ­£å¸¸ç¨¼åƒä¸­';
                    statusEl.style.background = '#6750a4';
                } else {
                    statusEl.innerHTML = 'âš ï¸ API æ¥ç¶šä¸å®‰å®š';
                    statusEl.style.background = '#ed8936';
                }
            } catch (error) {
                const statusEl = document.getElementById('apiStatus');
                statusEl.innerHTML = 'âŒ API æ¥ç¶šã‚¨ãƒ©ãƒ¼';
                statusEl.style.background = '#e53e3e';
            }
        }

        // å¤©æ°—æƒ…å ±ã®å–å¾—ã¨è¡¨ç¤º
        async function loadWeatherData() {
            console.log('ğŸŒ¤ï¸ å¤©æ°—æƒ…å ±ã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹...');
            
            const weatherLoading = document.getElementById('weatherLoading');
            const weatherContent = document.getElementById('weatherContent');
            const weatherError = document.getElementById('weatherError');
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            weatherLoading.style.display = 'block';
            
            // ä½ç½®æƒ…å ±ã®å–å¾—ã‚’è©¦è¡Œ
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    // æˆåŠŸæ™‚
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        console.log(`ğŸ“ ä½ç½®æƒ…å ±å–å¾—æˆåŠŸ: ç·¯åº¦ ${lat}, çµŒåº¦ ${lon}`);
                        
                        try {
                            const weatherUrl = `/api/weather/?lat=${lat}&lon=${lon}`;
                            const response = await fetch(weatherUrl);
                            const data = await response.json();
                            
                            if (data.success && data.weather) {
                                updateWeatherUI(data.weather);
                                weatherLoading.style.display = 'none';
                                weatherContent.style.display = 'block';
                            } else {
                                showWeatherError();
                            }
                        } catch (error) {
                            console.error('âŒ å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                            showWeatherError();
                        }
                    },
                    // ã‚¨ãƒ©ãƒ¼æ™‚
                    (error) => {
                        console.error('âŒ ä½ç½®æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error.code, error.message);
                        showWeatherError();
                    },
                    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³
                    {
                        timeout: 10000,
                        enableHighAccuracy: false
                    }
                );
            } else {
                console.error('âŒ ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“');
                showWeatherError();
            }
        }
        
        function updateWeatherUI(weather) {
            // ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—
            const now = new Date();
            
            // å¤©æ°—æƒ…å ±ã‚’UIã«åæ˜ 
            document.getElementById('weatherEmoji').textContent = weather.emoji || 'ğŸŒ¤ï¸';
            document.getElementById('weatherLocation').textContent = weather.city_name || 'ç¾åœ¨åœ°';
            document.getElementById('weatherTemp').textContent = `${weather.temperature}Â°C`;
            document.getElementById('weatherDesc').textContent = weather.weather_description || '--';
            document.getElementById('weatherFeelsLike').textContent = `${weather.feels_like}Â°C`;
            document.getElementById('weatherHumidity').textContent = `${weather.humidity}%`;
            document.getElementById('weatherWind').textContent = `${weather.wind_speed} m/s`;
            document.getElementById('weatherClouds').textContent = `${weather.clouds}%`;
            
            // æ—¥ä»˜ã¨å››å­£ã‚’è¡¨ç¤ºï¼ˆã“ã‚Œã‚‰ã®è¦ç´ ã¯å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã®ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
            // document.getElementById('weatherDate').textContent = formatDate(now);
            // document.getElementById('weatherSeason').textContent = getSeason(now);
            
            // æ¨è–¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°ï¼ˆã“ã®è¦ç´ ã¯å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã®ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
            // if (weather.recommendation) {
            //     document.getElementById('weatherRecommendation').textContent = weather.recommendation;
            // }
        }
        
        function showWeatherError() {
            const weatherLoading = document.getElementById('weatherLoading');
            const weatherContent = document.getElementById('weatherContent');
            const weatherError = document.getElementById('weatherError');
            
            weatherLoading.style.display = 'none';
            weatherContent.style.display = 'none';
            weatherError.style.display = 'block';
        }



        // ãƒ¢ãƒ‡ãƒ«èª¬æ˜ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateModelDescription() {
            const recommendType = document.querySelector('input[name="recommendType"]:checked').value;
            const modelDescription = document.getElementById('modelDescription');
            const flashDescription = document.getElementById('flashDescription');
            const proDescription = document.getElementById('proDescription');
            
            // ã™ã¹ã¦éè¡¨ç¤ºã«ãƒªã‚»ãƒƒãƒˆ
            modelDescription.style.display = 'none';
            flashDescription.style.display = 'none';
            proDescription.style.display = 'none';
            
            if (recommendType === 'ai-flash') {
                modelDescription.style.display = 'block';
                flashDescription.style.display = 'block';
            } else if (recommendType === 'ai-pro') {
                modelDescription.style.display = 'block';
                proDescription.style.display = 'block';
            }
        }
        
        // æ¨è–¦ã‚¿ã‚¤ãƒ—é¸æŠã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        function setupRecommendationTypeListeners() {
            const radioButtons = document.querySelectorAll('input[name="recommendType"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', updateModelDescription);
            });
            // åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
            updateModelDescription();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        window.addEventListener('load', () => {
            // ãƒ†ãƒ¼ãƒã‚’æœ€åˆã«è¨­å®š
            setupThemeToggle();
            
            // æ¨è–¦ã‚¿ã‚¤ãƒ—ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            setupRecommendationTypeListeners();
            
            // ãã®ä»–ã®åˆæœŸåŒ–å‡¦ç†
            checkAPIStatus();
            loadWeatherData();
            setInterval(checkAPIStatus, 30000);
        });

        // ä½œå“æ¨è–¦æ©Ÿèƒ½
        let currentLocation = null;

        // ä½œå“æ¨è–¦ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        async function getBookRecommendation() {
            console.log('ğŸ“š ä½œå“æ¨è–¦æ©Ÿèƒ½é–‹å§‹');
            
            const recommendType = document.querySelector('input[name="recommendType"]:checked').value;
            const isAI = recommendType.startsWith('ai-');
            let modelType = 'flash';
            
            if (recommendType === 'ai-flash') {
                modelType = 'flash';
            } else if (recommendType === 'ai-pro') {
                modelType = 'pro';
            }
            
            console.log(`ğŸ¯ æ¨è–¦ã‚¿ã‚¤ãƒ—: ${recommendType}, AI: ${isAI}, ãƒ¢ãƒ‡ãƒ«: ${modelType}`);
            
            // UIçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            hideAllRecommendationSections();
            document.getElementById('recommendationResults').style.display = 'block';
            document.getElementById('recommendationLoading').style.display = 'block';
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            const btn = document.getElementById('getRecommendationBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = 'ğŸ” æ¨è–¦ä¸­...';
            
            try {
                // ä½ç½®æƒ…å ±ã‚’å–å¾—ï¼ˆæ—¢å­˜ã®ã‚‚ã®ãŒã‚ã‚Œã°ä½¿ç”¨ï¼‰
                if (!currentLocation) {
                    currentLocation = await getCurrentLocation();
                }
                
                // æ¨è–¦APIã‚’å‘¼ã³å‡ºã—
                const url = `/api/recommend/?lat=${currentLocation.lat}&lon=${currentLocation.lon}&use_ai=${isAI}&model_type=${modelType}`;
                console.log(`ğŸ“¡ æ¨è–¦APIå‘¼ã³å‡ºã—: ${url}`);
                
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('ğŸ“Š æ¨è–¦APIçµæœ:', data);
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éš ã™
                document.getElementById('recommendationLoading').style.display = 'none';
                
                if (data.success) {
                    showRecommendationResult(data, isAI);
                } else {
                    showRecommendationError(data.message || 'æ¨è–¦ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                console.error('âŒ æ¨è–¦å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('recommendationLoading').style.display = 'none';
                showRecommendationError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
            } finally {
                // ãƒœã‚¿ãƒ³ã‚’å¾©å…ƒ
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // ç¾åœ¨ä½ç½®ã‚’å–å¾—
        function getCurrentLocation() {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const location = {
                                lat: position.coords.latitude,
                                lon: position.coords.longitude
                            };
                            console.log('ğŸ“ ä½ç½®æƒ…å ±å–å¾—æˆåŠŸ:', location);
                            updateLocationStatus(`ğŸ“ ç¾åœ¨åœ°: ç·¯åº¦ ${location.lat.toFixed(4)}, çµŒåº¦ ${location.lon.toFixed(4)}`);
                            resolve(location);
                        },
                        (error) => {
                            console.warn('âš ï¸ ä½ç½®æƒ…å ±å–å¾—å¤±æ•—ã€æ±äº¬é§…ã‚’ä½¿ç”¨:', error);
                            const defaultLocation = { lat: 35.681236, lon: 139.767125 };
                            updateLocationStatus('ğŸ“ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½ç½®ï¼ˆæ±äº¬é§…ï¼‰ã‚’ä½¿ç”¨ä¸­');
                            resolve(defaultLocation);
                        },
                        {
                            timeout: 10000,
                            enableHighAccuracy: false
                        }
                    );
                } else {
                    console.warn('âš ï¸ ä½ç½®æƒ…å ±éå¯¾å¿œã€æ±äº¬é§…ã‚’ä½¿ç”¨');
                    const defaultLocation = { lat: 35.681236, lon: 139.767125 };
                    updateLocationStatus('ğŸ“ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½ç½®ï¼ˆæ±äº¬é§…ï¼‰ã‚’ä½¿ç”¨ä¸­');
                    resolve(defaultLocation);
                }
            });
        }

        // ä½ç½®æƒ…å ±ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
        function updateLocationStatus(message) {
            document.getElementById('locationStatus').textContent = message;
        }

        // æ¨è–¦çµæœã‚’è¡¨ç¤º
        function showRecommendationResult(data, isAI) {
            document.getElementById('recommendationContent').style.display = 'block';
            
            if (isAI) {
                // AIç‰ˆã®çµæœè¡¨ç¤º
                document.getElementById('aiRecommendationResult').style.display = 'block';
                document.getElementById('simpleRecommendationResult').style.display = 'none';
                document.getElementById('aiRecommendationText').textContent = data.recommendation;
                
                // ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
                const modelInfo = document.getElementById('aiModelInfo');
                const modelUsed = data.model_used || 'gemini-2.5-flash';
                const modelIcon = modelUsed.includes('pro') ? 'ğŸ§ ' : 'ğŸš€';
                const modelName = modelUsed.includes('pro') ? 'Gemini 2.5 Proï¼ˆé«˜æ€§èƒ½ç‰ˆï¼‰' : 'Gemini 2.5 Flashï¼ˆè»½é‡ç‰ˆï¼‰';
                modelInfo.textContent = `${modelIcon} ${modelName} ã«ã‚ˆã‚‹æ¨è–¦`;
            } else {
                // ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã®çµæœè¡¨ç¤º
                document.getElementById('simpleRecommendationResult').style.display = 'block';
                document.getElementById('aiRecommendationResult').style.display = 'none';
                
                document.getElementById('recommendedMood').textContent = data.recommended_mood;
                document.getElementById('weatherMessage').textContent = data.weather_message;
                
                // ä½œå®¶ã‚¿ã‚°ã‚’è¡¨ç¤º
                const authorsContainer = document.getElementById('suggestedAuthors');
                authorsContainer.innerHTML = data.suggested_authors.map(author => `
                    <span style="
                        background: #e8def8;
                        color: #1d192b;
                        padding: 8px 16px;
                        border-radius: 16px;
                        font-size: 14px;
                        border: 1px solid #cab6cf;
                    ">${author}</span>
                `).join('');
            }
        }

        // æ¨è–¦ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
        function showRecommendationError(message) {
            document.getElementById('recommendationError').style.display = 'block';
            document.getElementById('recommendationErrorMessage').textContent = message;
        }

        // æ¨è–¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã™ã¹ã¦éš ã™
        function hideAllRecommendationSections() {
            document.getElementById('recommendationLoading').style.display = 'none';
            document.getElementById('recommendationContent').style.display = 'none';
            document.getElementById('recommendationError').style.display = 'none';
            document.getElementById('simpleRecommendationResult').style.display = 'none';
            document.getElementById('aiRecommendationResult').style.display = 'none';
        }

        // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const currentIcon = document.getElementById('themeIcon');
            const htmlElement = document.documentElement;

            // ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ¼ãƒã‚’èª­ã¿è¾¼ã¿ã€ãªã‘ã‚Œã°ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«
            const savedTheme = localStorage.getItem('theme') || 'dark';
            htmlElement.setAttribute('data-theme', savedTheme);

            function updateIcon() {
                if (htmlElement.getAttribute('data-theme') === 'dark') {
                    currentIcon.textContent = 'â˜€ï¸';
                } else {
                    currentIcon.textContent = 'ğŸŒ™';
                }
            }

            updateIcon(); // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°

            themeToggle.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                htmlElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcon();
            });
        }
    </script>
    
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .recommendation-section .text-center {
            text-align: center;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
        @media (max-width: 768px) {
            .recommendation-section {
                padding: 40px 0 !important;
            }
            
            .recommendation-section h2 {
                font-size: 1.8rem !important;
            }
            
            .recommendation-section .recommendation-settings {
                padding: 20px !important;
            }
            
            .recommendation-section label {
                flex-direction: column !important;
                text-align: center !important;
                padding: 15px !important;
            }
            
            .recommendation-section label small {
                margin-left: 0 !important;
                margin-top: 5px !important;
            }
            
            #getRecommendationBtn {
                padding: 12px 25px !important;
                font-size: 1rem !important;
            }
        }
    </style>
</body>
</html> 